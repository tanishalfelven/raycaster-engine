(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const h of r.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&n(h)}).observe(document,{childList:!0,subtree:!0});function e(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerpolicy&&(r.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?r.credentials="include":s.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(s){if(s.ep)return;s.ep=!0;const r=e(s);fetch(s.href,r)}})();let l;const d={init(i,t){l=t,this.documentCtx=this.initCanvas(i),this.bc=this.initCanvas(document.createElement("canvas")),this.monitorData={}},initCanvas(i){document.body.contains(i)&&(i.style.position="absolute",i.style.top="0",i.style.left="0"),i.width=l.width,i.height=l.height;const t=i.getContext("2d");return t.width=l.width,t.height=l.height,t},setStyle(i,t){i&&(t&&typeof i=="string"?this.bc.fillStyle=i:typeof i=="object"&&(i.lineWidth&&(this.bc.lineWidth=i.lineWidth),i.strokeStyle&&(this.bc.strokeStyle=i.strokeStyle)))},rect(i,t,e,n,s,r=!0){this.setStyle(s,r),r?this.bc.fillRect(i,t,e,n):this.bc.strokeRect(i,t,e,n)},monitor(i,t){this.monitorData[i]=t},renderMonitorData(){const i=this;let t=this.bc.height-Object.keys(this.monitorData).length*l.dFontHeight;this.setTextFillStyle(),Object.keys(this.monitorData).forEach(e=>{let n="";e.length<l.dMaxAlignSpace&&(n=" ".repeat(l.dMaxAlignSpace-e.length)),i.text(`${e}:${n}${i.monitorData[e]}`,2,t),t+=l.dFontHeight})},setTextFillStyle(){this.bc.fillStyle="white",this.bc.font=`${l.dFontHeight}px Consolas`},text(i,t,e){this.bc.fillText(i,t,e)},line(i,t,e,n,s={lineWidth:"1px",strokeStyle:"black"}){this.setStyle(s,!1),this.bc.beginPath(),this.bc.moveTo(i,t),this.bc.lineTo(e,n),this.bc.stroke()},polygon(i,t,e=!0){const n=this;this.setStyle(t,e),this.bc.beginPath(),i.forEach((s,r)=>{r===0?n.bc.moveTo(s.x,s.y):n.bc.lineTo(s.x,s.y)}),e?this.bc.fill():(this.bc.closePath(),this.bc.stroke())},clear(){this.rect(0,0,l.width,l.height,"gray"),this.monitorData={}},render(){this.renderMonitorData(),this.documentCtx.drawImage(this.bc.canvas,0,0),this.clear()}},c={getWidth(){return Math.max(document.body.scrollWidth,document.documentElement.scrollWidth,document.body.offsetWidth,document.documentElement.offsetWidth,document.documentElement.clientWidth)},getHeight(){return Math.max(document.body.scrollHeight,document.documentElement.scrollHeight,document.body.offsetHeight,document.documentElement.offsetHeight,document.documentElement.clientHeight)},_2pi:Math.PI*2,_piOver2:Math.PI/2,_3piOver2:Math.PI*3/2,_piOver180:Math.PI/180,wrapRadian(i){return i>this._2pi?i%this._2pi:i<0?this._2pi+i:i},toRadians(i){return i*this._piOver180},roundNumToPlace(i,t){const e=Math.pow(10,t);return Math.round(i*e)/e}},a={width:c.getWidth(),height:c.getHeight(),clearColor:"white",targetFps:60,scale:20,rays:320,fov:c.toRadians(60),dFontHeight:14,dMaxAlignSpace:20};class o{constructor(t,e=t){this.x=t,this.y=e}distanceFrom(t){return Math.sqrt(Math.pow(t.x-this.x,2)+Math.pow(t.y-this.y,2))}toString(){return`(${c.roundNumToPlace(this.x,2)}, ${c.roundNumToPlace(this.y,2)})`}add(t){return new o(this.x+t.x,this.y+t.y)}subtract(t){return new o(this.x-t.x,this.y-t.y)}multiply(t){return new o(this.x*t.x,this.y*t.y)}divide(t){return new o(this.x*t.x,this.y*t.y)}}class f{constructor(t,e){this.a=t,this.b=e}xInside(t){return this.a.x<=t&&t<=this.b.x||this.b.x<=t&&t<=this.a.x}yInside(t){return this.a.y<=t&&t<=this.b.y||this.b.y<=t&&t<=this.a.y}slope(){return f.slope(this.a,this.b)}static slope(t,e){return t.x===e.x?0:(t.y-e.y)/(t.x-e.x)}toString(){return`${this.a}${this.b}`}}class p{constructor(t,e,n=null){Object.assign(this,e),this.boundaries=t,this.lines=this._generateLines(),this.children=[],n&&this.addChild(n)}_generateLines(){const t=[];return this.boundaries.forEach((e,n)=>{let s;n+1<this.boundaries.length?s=this.boundaries[n+1]:s=this.boundaries[0],t.push(new f(e,s))}),t}addChild(t){return this.children=this.children.concat(t),this}render(){const t=this.boundaries.map(e=>new o(e.x*a.scale,e.y*a.scale));d.polygon(t,"white"),d.polygon(t,{lineWidth:"5px",strokeStyle:"red"},!1),this.children.forEach(e=>e.render())}static box(t,e,n,s){return[new o(t,e),new o(t,e+s),new o(t+n,e+s),new o(t+n,e)]}static diamond(t,e,n,s){return[new o(t+n/2,e),new o(t+n,e+s/2),new o(t+n/2,e+s),new o(t,e+s/2)]}static getSection(){return new p(p.box(1,1,11,11),{y:0,height:1},new p(p.diamond(5,5,3,3),{y:0,height:1}))}}const y={init(i){this.canvas=i,this.initMouseLock(),this.initKeyTracker()},capture(){this.canvas.requestPointerLock()},initMouseLock(){this.capture()},initKeyTracker(){const i=this.keytracker={};window.addEventListener("keydown",t=>{i[t.key]=!0}),window.addEventListener("keyup",t=>{i[t.key]=!1})},isPressed(i){return this.keytracker[i]}};class b extends o{constructor(t,e,n){super(t,e),this.angle=n}toString(){return`${super.toString()}(a = ${c.roundNumToPlace(this.angle,2)}rad)`}rotate(t){this.angle=c.wrapRadian(this.angle+t)}project(t,e=0){return new o(Math.cos(c.wrapRadian(this.angle+e))*t,Math.sin(c.wrapRadian(-this.angle-e))*t)}isInDirection(t,e,n=0){const s=c.wrapRadian(this.angle+n),r=c._piOver2<=s&&s<=c._3piOver2,h=0<=s&&s<=Math.PI;let m=!1,g=!1;return r&&t<=this.x&&(m=!0),!r&&t>=this.x&&(m=!0),h&&e<=this.y&&(g=!0),!h&&e>=this.y&&(g=!0),m&&g}getIntersect(t,e=0){const n=f.slope(this.add(this.project(1,e)),this),s=t.slope();let r=t.a.x,h=t.a.y;return s===0?t.a.y!==t.b.y?h=n*r+n*-this.x+this.y:t.a.x!==t.b.x&&(r=(-h-n*this.x+this.y)/-n):(h=(n*s*this.x-n*s*t.a.x+n*t.a.y-s*this.y)/(n-s),r=(n*this.x-s*t.a.x-this.y+t.a.y)/(n-s)),t.xInside(r)&&t.yInside(h)&&this.isInDirection(r,h,e)&&this.distanceFrom(new o(r,h))}getNearestLineDistance(t,e=0){const n=this;let s=[];return t.lines.forEach(r=>{const h=n.getIntersect(r,e);h&&s.push(h)}),t.children.forEach(r=>{const h=n.getNearestLineDistance(r,e);h&&(s=s.concat(h))}),Math.min(...s)}}class w extends b{constructor(t,e){super(t,e,0),this.fov=c.toRadians(60),this.moveSpeed=60/1e3,this.rotateSpeed=10*Math.PI/1e3}update(t){const e=this.project(this.moveSpeed*t);y.isPressed("w")?(this.x+=e.x,this.y+=e.y):y.isPressed("s")&&(this.x-=e.x,this.y-=e.y);const n=this.rotateSpeed*t;y.isPressed("a")?this.rotate(n):y.isPressed("d")&&this.rotate(-n)}render(){const t=this.x*a.scale,e=this.y*a.scale;d.rect(t-a.scale/4,e-a.scale/4,a.scale/2,a.scale/2,"red");const n=this.project(1);d.line(t,e,t+n.x*a.scale,e+n.y*a.scale)}}class x{constructor(t,e){this.map=t,this.player=e,this.visibleWalls=[]}update(){const t=a.fov/a.rays;this.visibleWalls=[];let e=0,n=-a.fov/2;for(;e<a.rays;e++){const s=this.player.getNearestLineDistance(this.map,n);s&&this.visibleWalls.push(s*Math.cos(n)),n+=t}}render(){this.visibleWalls.forEach((n,s)=>{const r=10/n*100;d.rect((a.rays-1-s)/a.rays*a.width,a.height/2-r/2,a.width/a.rays,r,`hsl(120, 100%, ${100-(n+8)/20*100}%)`)})}}const u=1e3/a.targetFps;class v{constructor({update:t,render:e}){this.render=e,this.update=t,this.then=Date.now(),this.acc=0}handleLoop(){this.now=Date.now();let t=this.now-this.then;if(this.then=this.now,this.acc+=t,0<=this.acc&&this.acc<u)this.update(this.acc/u),this.render();else{for(;this.acc>=u;)this.previousState=this.currentState,this.update(this.acc/u),this.then+=u,this.acc-=u;this.render()}}}function S(){const i=document.createElement("canvas");return document.body.appendChild(i),i}class k{constructor({init:t=()=>null,update:e=()=>null,render:n=()=>null,setupWebpage:s=S}){this.init=t.bind(this),this.update=e.bind(this),this.render=n.bind(this),this.setupWebpage=s.bind(this);const r=this;window.onload=()=>r.initGame()}initGame(){this.canvas=this.setupWebpage(),this.init(),this.delta=new v({render:(...t)=>this.render(...t),update:(...t)=>this.update(...t)}),this.loop()}loop(){window.requestAnimationFrame(this.loop.bind(this)),this.delta.handleLoop()}}new k({init(){d.init(this.canvas,a),y.init(this.canvas),this.map=p.getSection(),this.player=new w(2,2),this.raycaster=new x(this.map,this.player)},update(i){this.player.update(i),this.raycaster.update()},render(){this.raycaster.render(),this.map.render(),this.player.render(),d.render()}});
